<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

    >airplay-js (v0.3.0)</a>
</h1>
<h4>JS Native Apple AirPlay client library for AppleTV</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.airplay-js">module airplay-js</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Browser">
            function <span class="apidocSignatureSpan">airplay-js.</span>Browser
            <span class="apidocSignatureSpan">( options )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device">
            function <span class="apidocSignatureSpan">airplay-js.</span>Device
            <span class="apidocSignatureSpan">( id, info, name, callback )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.HLS">
            function <span class="apidocSignatureSpan">airplay-js.</span>HLS
            <span class="apidocSignatureSpan">( options )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.connect">
            function <span class="apidocSignatureSpan">airplay-js.</span>connect
            <span class="apidocSignatureSpan">( host, port, pass, callback )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.createBrowser">
            function <span class="apidocSignatureSpan">airplay-js.</span>createBrowser
            <span class="apidocSignatureSpan">( options )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.createHLS">
            function <span class="apidocSignatureSpan">airplay-js.</span>createHLS
            <span class="apidocSignatureSpan">( options )</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">airplay-js.</span>Browser.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">airplay-js.</span>Device.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">airplay-js.</span>HLS.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">airplay-js.</span>browser</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">airplay-js.</span>client</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">airplay-js.</span>device</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">airplay-js.</span>hls</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.airplay-js.Browser">module airplay-js.Browser</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Browser.Browser">
            function <span class="apidocSignatureSpan">airplay-js.</span>Browser
            <span class="apidocSignatureSpan">( options )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Browser.super_">
            function <span class="apidocSignatureSpan">airplay-js.Browser.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.airplay-js.Browser.prototype">module airplay-js.Browser.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Browser.prototype.getDevice">
            function <span class="apidocSignatureSpan">airplay-js.Browser.prototype.</span>getDevice
            <span class="apidocSignatureSpan">( info )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Browser.prototype.getDeviceById">
            function <span class="apidocSignatureSpan">airplay-js.Browser.prototype.</span>getDeviceById
            <span class="apidocSignatureSpan">( deviceId, skipCheck )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Browser.prototype.getDevices">
            function <span class="apidocSignatureSpan">airplay-js.Browser.prototype.</span>getDevices
            <span class="apidocSignatureSpan">( skipCheck )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Browser.prototype.init">
            function <span class="apidocSignatureSpan">airplay-js.Browser.prototype.</span>init
            <span class="apidocSignatureSpan">( options )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Browser.prototype.isValid">
            function <span class="apidocSignatureSpan">airplay-js.Browser.prototype.</span>isValid
            <span class="apidocSignatureSpan">( info )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Browser.prototype.start">
            function <span class="apidocSignatureSpan">airplay-js.Browser.prototype.</span>start
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Browser.prototype.stop">
            function <span class="apidocSignatureSpan">airplay-js.Browser.prototype.</span>stop
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.airplay-js.Device">module airplay-js.Device</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.Device">
            function <span class="apidocSignatureSpan">airplay-js.</span>Device
            <span class="apidocSignatureSpan">( id, info, name, callback )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.super_">
            function <span class="apidocSignatureSpan">airplay-js.Device.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.airplay-js.Device.prototype">module airplay-js.Device.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.prototype.authorize">
            function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>authorize
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.prototype.close">
            function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>close
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.prototype.getInfo">
            function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>getInfo
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.prototype.isReady">
            function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>isReady
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.prototype.match">
            function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>match
            <span class="apidocSignatureSpan">( info )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.prototype.onReady">
            function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>onReady
            <span class="apidocSignatureSpan">( callback )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.prototype.photo">
            function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>photo
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.prototype.play">
            function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>play
            <span class="apidocSignatureSpan">(media, position, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.prototype.rate">
            function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>rate
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.prototype.reverse">
            function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>reverse
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.prototype.scrub">
            function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>scrub
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.prototype.simpleplay">
            function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>simpleplay
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.prototype.status">
            function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>status
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.prototype.stop">
            function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>stop
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.Device.prototype.volume">
            function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>volume
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.airplay-js.HLS">module airplay-js.HLS</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.HLS.HLS">
            function <span class="apidocSignatureSpan">airplay-js.</span>HLS
            <span class="apidocSignatureSpan">( options )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.HLS.super_">
            function <span class="apidocSignatureSpan">airplay-js.HLS.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.airplay-js.HLS.prototype">module airplay-js.HLS.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.HLS.prototype.command4FFMpeg">
            function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>command4FFMpeg
            <span class="apidocSignatureSpan">( tsIndex, tsOutput )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.HLS.prototype.command4FFProbe">
            function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>command4FFProbe
            <span class="apidocSignatureSpan">( filePath )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.HLS.prototype.getURI">
            function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>getURI
            <span class="apidocSignatureSpan">( type, index )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.HLS.prototype.httpHandler">
            function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>httpHandler
            <span class="apidocSignatureSpan">( request, response )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.HLS.prototype.open">
            function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>open
            <span class="apidocSignatureSpan">( fileFullPath, callback )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.HLS.prototype.segment">
            function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>segment
            <span class="apidocSignatureSpan">( index, req, res )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.HLS.prototype.setSubtitles">
            function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>setSubtitles
            <span class="apidocSignatureSpan">( subtitles )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.HLS.prototype.start">
            function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>start
            <span class="apidocSignatureSpan">( port )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.HLS.prototype.stop">
            function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>stop
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.airplay-js.browser">module airplay-js.browser</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.browser.Browser">
            function <span class="apidocSignatureSpan">airplay-js.browser.</span>Browser
            <span class="apidocSignatureSpan">( options )</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.airplay-js.client">module airplay-js.client</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.client.Client">
            function <span class="apidocSignatureSpan">airplay-js.client.</span>Client
            <span class="apidocSignatureSpan">( options, callback )</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.airplay-js.device">module airplay-js.device</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.device.Device">
            function <span class="apidocSignatureSpan">airplay-js.device.</span>Device
            <span class="apidocSignatureSpan">( id, info, name, callback )</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.airplay-js.hls">module airplay-js.hls</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.airplay-js.hls.HLS">
            function <span class="apidocSignatureSpan">airplay-js.hls.</span>HLS
            <span class="apidocSignatureSpan">( options )</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.airplay-js" id="apidoc.module.airplay-js">module airplay-js</a></h1>


    <h2>
        <a href="#apidoc.element.airplay-js.Browser" id="apidoc.element.airplay-js.Browser">
        function <span class="apidocSignatureSpan">airplay-js.</span>Browser
        <span class="apidocSignatureSpan">( options )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Browser = function ( options ) {
    events.EventEmitter.call( this );
    this.init( options );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
/**
* create a Browser
*
* @param {Object=} options
* @return {Browser} instance of Browser
*/
exports.createBrowser = function ( options ) {
   return new exports.<span class="apidocCodeKeywordSpan">Browser</span>( options );
};

/**
* connect a airplay device
*
* @param {string} host airplay host
* @param {number} port airplay port
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device" id="apidoc.element.airplay-js.Device">
        function <span class="apidocSignatureSpan">airplay-js.</span>Device
        <span class="apidocSignatureSpan">( id, info, name, callback )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Device( id, info, name, callback ) {
    var self = this;

    events.EventEmitter.call( this );

    this.id = id;
    this.info = info;
    this.name = name;
    // this.serverInfo = null;
    this.pingDelay = 5 * 1000; // 心跳间隔

    this.client = new Client(
        {
            host: info[0], port: 7000
            // ,user: &#x27;zfkun&#x27;, pass: &#x27;&#x27;
        },
        function () {
            self.client.serverInfo(function( info ) {
                self.serverInfo = info;
                self.onReady( callback );
            });
        }
    );
    this.client.on( &#x27;ping&#x27;, function () { self.emit( &#x27;ping&#x27; ); });

    self.hls = require( &#x27;../airplay&#x27; ).createHLS();
    self.hls.on( &#x27;start&#x27;, function () {
        console.info( &#x27;[HLS] start: %s&#x27;, self.hls.getURI() );
    });
    self.hls.on( &#x27;stop&#x27;, function () {
        console.info( &#x27;[HLS] stop: %s&#x27;, self.hls.getURI() );
    });
    self.hls.on( &#x27;request&#x27;, function ( req ) {
        // var uri = url.parse( req.url, true );
        console.info( &#x27;[HLS] request: %s&#x27;, req.url );
    });
    self.hls.on( &#x27;process&#x27;, function ( d ) {
        console.info( &#x27;[HLS] segment process: %s, %s, %s&#x27;, d.index, d.file, d.out.toString() );
    });
    self.hls.on( &#x27;segment&#x27;, function ( d ) {
        console.info( &#x27;[HLS] segment created: %s, %s, %s&#x27;, d.index, d.file, d.out );
    });
    self.hls.on( &#x27;open&#x27;, function ( d ) {
        console.info( &#x27;[HLS] opend: %s, %s&#x27;, d.file, util.inspect( d.info ) );
    });
    self.hls.on( &#x27;error&#x27;, function ( err ) {
        console.info( &#x27;[HLS] segment error: &#x27;, util.inspect( err ) );
    });


}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.HLS" id="apidoc.element.airplay-js.HLS">
        function <span class="apidocSignatureSpan">airplay-js.</span>HLS
        <span class="apidocSignatureSpan">( options )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function HLSServer( options ) {
    events.EventEmitter.call( this );
    var ops = this.options = options || {};

    // 是否启用流模式(影响m3u8生成机制)
    // ops.streaming = !!ops.streaming;
    // TS文件缓存
    ops.cache = !!ops.cache;
    // TS分片时长(s)
    ops.duration = ops.duration || 20;
    // 编解码库目录
    ops.lib = path.normalize( ops.lib || ( __dirname + &#x27;/../dep&#x27; ) ) + &#x27;/&#x27;;
    if ( !fs.existsSync( ops.lib ) ) {
        ops.lib = &#x27;&#x27;;
    }
    // TS分片输出目录
    ops.out = path.normalize( ops.out || ( &#x27;/tmp&#x27; ) ) + &#x27;/&#x27;;
    if ( !fs.existsSync( ops.out ) ) {
        fs.mkdirSync( ops.out );
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
/**
* create a HLS Server
*
* @param {Object=} options
* @return {HLS} instance of HLS
*/
exports.createHLS = function ( options ) {
   return new exports.<span class="apidocCodeKeywordSpan">HLS</span>( options );
};

/**
* create a Browser
*
* @param {Object=} options
* @return {Browser} instance of Browser
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.connect" id="apidoc.element.airplay-js.connect">
        function <span class="apidocSignatureSpan">airplay-js.</span>connect
        <span class="apidocSignatureSpan">( host, port, pass, callback )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function ( host, port, pass, callback ) {
    throw &#x27;not yet implemented&#x27;;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.createBrowser" id="apidoc.element.airplay-js.createBrowser">
        function <span class="apidocSignatureSpan">airplay-js.</span>createBrowser
        <span class="apidocSignatureSpan">( options )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createBrowser = function ( options ) {
    return new exports.Browser( options );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

	npm install airplay-js

## Usage

``` javascript
// remote video
var browser = require( &#x27;airplay-js&#x27; ).<span class="apidocCodeKeywordSpan">createBrowser</span>();
browser.on( &#x27;deviceOn&#x27;, function( device ) {
    device.play( &#x27;http://remotehost/video.mp4&#x27;, 0, function() {
        console.info( &#x27;video playing...&#x27; );
    });
});
browser.start();
```
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.createHLS" id="apidoc.element.airplay-js.createHLS">
        function <span class="apidocSignatureSpan">airplay-js.</span>createHLS
        <span class="apidocSignatureSpan">( options )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createHLS = function ( options ) {
    return new exports.HLS( options );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            self.serverInfo = info;
            self.onReady( callback );
        });
    }
);
this.client.on( &#x27;ping&#x27;, function () { self.emit( &#x27;ping&#x27; ); });

self.hls = require( &#x27;../airplay&#x27; ).<span class="apidocCodeKeywordSpan">createHLS</span>();
self.hls.on( &#x27;start&#x27;, function () {
    console.info( &#x27;[HLS] start: %s&#x27;, self.hls.getURI() );
});
self.hls.on( &#x27;stop&#x27;, function () {
    console.info( &#x27;[HLS] stop: %s&#x27;, self.hls.getURI() );
});
self.hls.on( &#x27;request&#x27;, function ( req ) {
...</pre></li>
    </ul>
















</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.airplay-js.Browser" id="apidoc.module.airplay-js.Browser">module airplay-js.Browser</a></h1>


    <h2>
        <a href="#apidoc.element.airplay-js.Browser.Browser" id="apidoc.element.airplay-js.Browser.Browser">
        function <span class="apidocSignatureSpan">airplay-js.</span>Browser
        <span class="apidocSignatureSpan">( options )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Browser = function ( options ) {
    events.EventEmitter.call( this );
    this.init( options );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
/**
* create a Browser
*
* @param {Object=} options
* @return {Browser} instance of Browser
*/
exports.createBrowser = function ( options ) {
   return new exports.<span class="apidocCodeKeywordSpan">Browser</span>( options );
};

/**
* connect a airplay device
*
* @param {string} host airplay host
* @param {number} port airplay port
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Browser.super_" id="apidoc.element.airplay-js.Browser.super_">
        function <span class="apidocSignatureSpan">airplay-js.Browser.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.airplay-js.Browser.prototype" id="apidoc.module.airplay-js.Browser.prototype">module airplay-js.Browser.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.airplay-js.Browser.prototype.getDevice" id="apidoc.element.airplay-js.Browser.prototype.getDevice">
        function <span class="apidocSignatureSpan">airplay-js.Browser.prototype.</span>getDevice
        <span class="apidocSignatureSpan">( info )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getDevice = function ( info ) {
    for ( var deviceId in this.devices ) {
        var device = this.devices[ deviceId ];
        if ( device.match( info ) ) {
            return device;
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    });

    browser.on(&#x27;serviceDown&#x27;, function(info) {
      if ( !self.isValid( info ) ) {
            return;
        }

        var device = self.<span class="apidocCodeKeywordSpan">getDevice</span>( info );
        if ( device ) {
            device.close();
        }
    });
};

Browser.prototype.start = function () {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Browser.prototype.getDeviceById" id="apidoc.element.airplay-js.Browser.prototype.getDeviceById">
        function <span class="apidocSignatureSpan">airplay-js.Browser.prototype.</span>getDeviceById
        <span class="apidocSignatureSpan">( deviceId, skipCheck )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getDeviceById = function ( deviceId, skipCheck ) {
    var device = this.devices[ deviceId ];
    if ( device &#x26;&#x26; ( skipCheck || device.isReady() ) ) {
        return device;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Browser.prototype.getDevices" id="apidoc.element.airplay-js.Browser.prototype.getDevices">
        function <span class="apidocSignatureSpan">airplay-js.Browser.prototype.</span>getDevices
        <span class="apidocSignatureSpan">( skipCheck )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getDevices = function ( skipCheck ) {
    var devices = [];
    for ( var deviceId in this.devices ) {
        var device = this.devices[ deviceId ];
        if ( skipCheck || device.isReady() ) {
            devices.push( device );
        }
    }
    return devices;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Browser.prototype.init" id="apidoc.element.airplay-js.Browser.prototype.init">
        function <span class="apidocSignatureSpan">airplay-js.Browser.prototype.</span>init
        <span class="apidocSignatureSpan">( options )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function ( options ) {
    var self = this;
    var nextDeviceId = 0;

    this.devices = {};
    this.addresses = []

    var browser = mdns.createBrowser(mdns.tcp(&#x27;airplay&#x27;));

    browser.on(&#x27;ready&#x27;, function () {
        browser.discover();
    });

    browser.on(&#x27;serviceUp&#x27;, function(data) {
        if(data.port &#x26;&#x26; data.port == 7000 &#x26;&#x26; self.addresses.indexOf(data.address) &#x3c; 0){
            var info = [data.address]
            var name = data.name
            self.addresses.push(data.address)

            device = new Device( nextDeviceId++, info , name );
            device.on( &#x27;ready&#x27;, function( d ) {
                self.emit( &#x27;deviceOn&#x27;, d );
            });
            device.on( &#x27;close&#x27;, function( d ) {
                delete self.devices[ d.id ];
                self.emit( &#x27;deviceOff&#x27;, d );
            });

            self.devices[ device.id ] = device;
        }
    });

    browser.on(&#x27;serviceDown&#x27;, function(info) {
      if ( !self.isValid( info ) ) {
            return;
        }

        var device = self.getDevice( info );
        if ( device ) {
            device.close();
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var mdns = require( &#x27;mdns-js&#x27; );

var Device = require( &#x27;./device&#x27; ).Device;

var Browser = function( options ) {
    events.EventEmitter.call( this );
    this.<span class="apidocCodeKeywordSpan">init</span>( options );
};

util.inherits( Browser, events.EventEmitter );

exports.Browser = Browser;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Browser.prototype.isValid" id="apidoc.element.airplay-js.Browser.prototype.isValid">
        function <span class="apidocSignatureSpan">airplay-js.Browser.prototype.</span>isValid
        <span class="apidocSignatureSpan">( info )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">isValid = function ( info ) {
    if ( !info || !/^en\d+$/.test( info.networkInterface ) ) {
        return !1;
    }
    return !0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    });

    self.devices[ device.id ] = device;
}
    });

    browser.on(&#x27;serviceDown&#x27;, function(info) {
      if ( !self.<span class="apidocCodeKeywordSpan">isValid</span>( info ) ) {
    return;
}

var device = self.getDevice( info );
if ( device ) {
    device.close();
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Browser.prototype.start" id="apidoc.element.airplay-js.Browser.prototype.start">
        function <span class="apidocSignatureSpan">airplay-js.Browser.prototype.</span>start
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function () {
    this.emit( &#x27;start&#x27; );
    return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// remote video
var browser = require( &#x27;airplay-js&#x27; ).createBrowser();
browser.on( &#x27;deviceOn&#x27;, function( device ) {
    device.play( &#x27;http://remotehost/video.mp4&#x27;, 0, function() {
        console.info( &#x27;video playing...&#x27; );
    });
});
browser.<span class="apidocCodeKeywordSpan">start</span>();
```

## Testing

```
npm install
npm test
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Browser.prototype.stop" id="apidoc.element.airplay-js.Browser.prototype.stop">
        function <span class="apidocSignatureSpan">airplay-js.Browser.prototype.</span>stop
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stop = function () {
    this.emit( &#x27;stop&#x27; );
    return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.airplay-js.Device" id="apidoc.module.airplay-js.Device">module airplay-js.Device</a></h1>


    <h2>
        <a href="#apidoc.element.airplay-js.Device.Device" id="apidoc.element.airplay-js.Device.Device">
        function <span class="apidocSignatureSpan">airplay-js.</span>Device
        <span class="apidocSignatureSpan">( id, info, name, callback )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Device( id, info, name, callback ) {
    var self = this;

    events.EventEmitter.call( this );

    this.id = id;
    this.info = info;
    this.name = name;
    // this.serverInfo = null;
    this.pingDelay = 5 * 1000; // 心跳间隔

    this.client = new Client(
        {
            host: info[0], port: 7000
            // ,user: &#x27;zfkun&#x27;, pass: &#x27;&#x27;
        },
        function () {
            self.client.serverInfo(function( info ) {
                self.serverInfo = info;
                self.onReady( callback );
            });
        }
    );
    this.client.on( &#x27;ping&#x27;, function () { self.emit( &#x27;ping&#x27; ); });

    self.hls = require( &#x27;../airplay&#x27; ).createHLS();
    self.hls.on( &#x27;start&#x27;, function () {
        console.info( &#x27;[HLS] start: %s&#x27;, self.hls.getURI() );
    });
    self.hls.on( &#x27;stop&#x27;, function () {
        console.info( &#x27;[HLS] stop: %s&#x27;, self.hls.getURI() );
    });
    self.hls.on( &#x27;request&#x27;, function ( req ) {
        // var uri = url.parse( req.url, true );
        console.info( &#x27;[HLS] request: %s&#x27;, req.url );
    });
    self.hls.on( &#x27;process&#x27;, function ( d ) {
        console.info( &#x27;[HLS] segment process: %s, %s, %s&#x27;, d.index, d.file, d.out.toString() );
    });
    self.hls.on( &#x27;segment&#x27;, function ( d ) {
        console.info( &#x27;[HLS] segment created: %s, %s, %s&#x27;, d.index, d.file, d.out );
    });
    self.hls.on( &#x27;open&#x27;, function ( d ) {
        console.info( &#x27;[HLS] opend: %s, %s&#x27;, d.file, util.inspect( d.info ) );
    });
    self.hls.on( &#x27;error&#x27;, function ( err ) {
        console.info( &#x27;[HLS] segment error: &#x27;, util.inspect( err ) );
    });


}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device.super_" id="apidoc.element.airplay-js.Device.super_">
        function <span class="apidocSignatureSpan">airplay-js.Device.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.airplay-js.Device.prototype" id="apidoc.module.airplay-js.Device.prototype">module airplay-js.Device.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.airplay-js.Device.prototype.authorize" id="apidoc.element.airplay-js.Device.prototype.authorize">
        function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>authorize
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">authorize = function () {
    this.client[ api[1] ].apply( this.client, arguments );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device.prototype.close" id="apidoc.element.airplay-js.Device.prototype.close">
        function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>close
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function () {
    if ( this.client ) {
        this.client.close();
    }

    this.client = null;
    this.ready = !1;

    this.emit( &#x27;close&#x27;, this );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
browser.on(&#x27;serviceDown&#x27;, function(info) {
  if ( !self.isValid( info ) ) {
        return;
    }

    var device = self.getDevice( info );
    if ( device ) {
        device.<span class="apidocCodeKeywordSpan">close</span>();
    }
});
};

Browser.prototype.start = function () {
this.emit( &#x27;start&#x27; );
return this;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device.prototype.getInfo" id="apidoc.element.airplay-js.Device.prototype.getInfo">
        function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>getInfo
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getInfo = function () {
    var info = this.info;
    var txtRecord = info.txtRecord || {};
    var serverInfo = this.serverInfo;

    return {
        id: this.id,
        name: info.name,
        fullName: info.fullname,
        deviceId: txtRecord.deviceid || serverInfo.deviceId,
        features: serverInfo.features || txtRecord.features,
        model: serverInfo.model,
        interfaceName: info.networkInterface,
        interfaceIndex: info.interfaceIndex,
        addresses: info.addresses,

        flags: txtRecord.flags,
        pk: txtRecord.pk,

        osVersion: serverInfo.osVersion,
        protocolVersion: serverInfo.protocolVersion,
        sourceVersion: serverInfo.sourceVersion || txtRecord.srcvers,
        vv: serverInfo.vv || txtRecord.vv,

        slideshowFeatures: [],
        supportedContentTypes: []
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device.prototype.isReady" id="apidoc.element.airplay-js.Device.prototype.isReady">
        function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>isReady
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">isReady = function () {
  return !!this.ready;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        return device;
    }
}
};

Browser.prototype.getDeviceById = function ( deviceId, skipCheck ) {
var device = this.devices[ deviceId ];
if ( device &#x26;&#x26; ( skipCheck || device.<span class="apidocCodeKeywordSpan">isReady</span>() ) ) {
    return device;
}
};

Browser.prototype.getDevices = function ( skipCheck ) {
var devices = [];
for ( var deviceId in this.devices ) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device.prototype.match" id="apidoc.element.airplay-js.Device.prototype.match">
        function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>match
        <span class="apidocSignatureSpan">( info )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">match = function ( info ) {
    for ( var key in info ) {
        if ( this.info[ key ] != info[ key ] ) {
            return !1;
        }
    }
    return !0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}
return !0;
};

Browser.prototype.getDevice = function ( info ) {
for ( var deviceId in this.devices ) {
    var device = this.devices[ deviceId ];
    if ( device.<span class="apidocCodeKeywordSpan">match</span>( info ) ) {
        return device;
    }
}
};

Browser.prototype.getDeviceById = function ( deviceId, skipCheck ) {
var device = this.devices[ deviceId ];
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device.prototype.onReady" id="apidoc.element.airplay-js.Device.prototype.onReady">
        function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>onReady
        <span class="apidocSignatureSpan">( callback )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">onReady = function ( callback ) {
    this.ready = !0;

    if ( callback ) {
        callback( this );
    }

    this.emit( &#x27;ready&#x27;, this );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    {
        host: info[0], port: 7000
        // ,user: &#x27;zfkun&#x27;, pass: &#x27;&#x27;
    },
    function () {
        self.client.serverInfo(function( info ) {
            self.serverInfo = info;
            self.<span class="apidocCodeKeywordSpan">onReady</span>( callback );
        });
    }
);
this.client.on( &#x27;ping&#x27;, function () { self.emit( &#x27;ping&#x27; ); });

self.hls = require( &#x27;../airplay&#x27; ).createHLS();
self.hls.on( &#x27;start&#x27;, function () {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device.prototype.photo" id="apidoc.element.airplay-js.Device.prototype.photo">
        function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>photo
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">photo = function () {
    this.client[ api[1] ].apply( this.client, arguments );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device.prototype.play" id="apidoc.element.airplay-js.Device.prototype.play">
        function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>play
        <span class="apidocSignatureSpan">(media, position, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">play = function (media, position, callback){
    var self = this

    //#TODO: Check if has ffmpeg and if not, go directly to simpleplay
    //
    console.log(typeof(media))
    self.hls.start( 7001 + this.id );

    console.log(&#x22;going to play: &#x22;+media)
    self.hls.open( media , function ( info ) {
        device.simpleplay( self.hls.getURI(), &#x27;0.000000&#x27;, function ( res ) {
            console.info( &#x27;-&#x3e;&#x3e; &#x27;, res );
            setTimeout(function(){
                device.status( function ( info ) {
                    console.info( &#x27;-&#x3e;&#x3e; &#x27;, info ? info : &#x27;no info &#x3e;(&#x27; );
                    if ( info ) {
                        console.log(info)
                    }
                });
            }, 4000);
        });
    });
    self.hls.on(&#x27;NoFFMPEG&#x27;, function(){
        self.simpleplay(media, position, callback);
        self.emit(&#x27;NoFFMPEG&#x27;)
    })

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

## Usage

``` javascript
// remote video
var browser = require( &#x27;airplay-js&#x27; ).createBrowser();
browser.on( &#x27;deviceOn&#x27;, function( device ) {
    device.<span class="apidocCodeKeywordSpan">play</span>( &#x27;http://remotehost/video.mp4&#x27;, 0, function() {
        console.info( &#x27;video playing...&#x27; );
    });
});
browser.start();
```

## Testing
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device.prototype.rate" id="apidoc.element.airplay-js.Device.prototype.rate">
        function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>rate
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">rate = function () {
    this.client[ api[1] ].apply( this.client, arguments );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device.prototype.reverse" id="apidoc.element.airplay-js.Device.prototype.reverse">
        function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>reverse
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reverse = function () {
    this.client[ api[1] ].apply( this.client, arguments );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device.prototype.scrub" id="apidoc.element.airplay-js.Device.prototype.scrub">
        function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>scrub
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">scrub = function () {
    this.client[ api[1] ].apply( this.client, arguments );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device.prototype.simpleplay" id="apidoc.element.airplay-js.Device.prototype.simpleplay">
        function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>simpleplay
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">simpleplay = function () {
    this.client[ api[1] ].apply( this.client, arguments );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
//#TODO: Check if has ffmpeg and if not, go directly to simpleplay
//
console.log(typeof(media))
self.hls.start( 7001 + this.id );

console.log(&#x22;going to play: &#x22;+media)
self.hls.open( media , function ( info ) {
    device.<span class="apidocCodeKeywordSpan">simpleplay</span>( self.hls.getURI(), &#x27;0.000000&#x27;, function ( res ) {
        console.info( &#x27;-&#x3e;&#x3e; &#x27;, res );
        setTimeout(function(){
            device.status( function ( info ) {
                console.info( &#x27;-&#x3e;&#x3e; &#x27;, info ? info : &#x27;no info &#x3e;(&#x27; );
                if ( info ) {
                    console.log(info)
                }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device.prototype.status" id="apidoc.element.airplay-js.Device.prototype.status">
        function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>status
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">status = function () {
    this.client[ api[1] ].apply( this.client, arguments );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
self.hls.start( 7001 + this.id );

console.log(&#x22;going to play: &#x22;+media)
self.hls.open( media , function ( info ) {
    device.simpleplay( self.hls.getURI(), &#x27;0.000000&#x27;, function ( res ) {
        console.info( &#x27;-&#x3e;&#x3e; &#x27;, res );
        setTimeout(function(){
            device.<span class="apidocCodeKeywordSpan">status</span>( function ( info ) {
                console.info( &#x27;-&#x3e;&#x3e; &#x27;, info ? info : &#x27;no info &#x3e;(&#x27; );
                if ( info ) {
                    console.log(info)
                }
            });
        }, 4000);
    });
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device.prototype.stop" id="apidoc.element.airplay-js.Device.prototype.stop">
        function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>stop
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stop = function () {
    this.client[ api[1] ].apply( this.client, arguments );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.Device.prototype.volume" id="apidoc.element.airplay-js.Device.prototype.volume">
        function <span class="apidocSignatureSpan">airplay-js.Device.prototype.</span>volume
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">volume = function () {
    this.client[ api[1] ].apply( this.client, arguments );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.airplay-js.HLS" id="apidoc.module.airplay-js.HLS">module airplay-js.HLS</a></h1>


    <h2>
        <a href="#apidoc.element.airplay-js.HLS.HLS" id="apidoc.element.airplay-js.HLS.HLS">
        function <span class="apidocSignatureSpan">airplay-js.</span>HLS
        <span class="apidocSignatureSpan">( options )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function HLSServer( options ) {
    events.EventEmitter.call( this );
    var ops = this.options = options || {};

    // 是否启用流模式(影响m3u8生成机制)
    // ops.streaming = !!ops.streaming;
    // TS文件缓存
    ops.cache = !!ops.cache;
    // TS分片时长(s)
    ops.duration = ops.duration || 20;
    // 编解码库目录
    ops.lib = path.normalize( ops.lib || ( __dirname + &#x27;/../dep&#x27; ) ) + &#x27;/&#x27;;
    if ( !fs.existsSync( ops.lib ) ) {
        ops.lib = &#x27;&#x27;;
    }
    // TS分片输出目录
    ops.out = path.normalize( ops.out || ( &#x27;/tmp&#x27; ) ) + &#x27;/&#x27;;
    if ( !fs.existsSync( ops.out ) ) {
        fs.mkdirSync( ops.out );
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
/**
* create a HLS Server
*
* @param {Object=} options
* @return {HLS} instance of HLS
*/
exports.createHLS = function ( options ) {
   return new exports.<span class="apidocCodeKeywordSpan">HLS</span>( options );
};

/**
* create a Browser
*
* @param {Object=} options
* @return {Browser} instance of Browser
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.HLS.super_" id="apidoc.element.airplay-js.HLS.super_">
        function <span class="apidocSignatureSpan">airplay-js.HLS.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.airplay-js.HLS.prototype" id="apidoc.module.airplay-js.HLS.prototype">module airplay-js.HLS.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.airplay-js.HLS.prototype.command4FFMpeg" id="apidoc.element.airplay-js.HLS.prototype.command4FFMpeg">
        function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>command4FFMpeg
        <span class="apidocSignatureSpan">( tsIndex, tsOutput )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">command4FFMpeg = function ( tsIndex, tsOutput ) {
    var opt = [
        &#x27;-y&#x27;,
        &#x27;-i&#x27;,
        this.file,
        &#x27;-t&#x27;, this.options.duration,
        &#x27;-ss&#x27;, this.options.duration * (tsIndex - 1),
    ];

    var isH264 = this.videoInfo.streams.some(function ( s ) {
        return s.codec_name === &#x27;h264&#x27;;
    });

    // h264 &#x26;&#x26; aac
    if ( isH264 ) {
        opt = opt.concat([
            &#x27;-c:v&#x27;, &#x27;libx264&#x27;, // libx264 || copy
            &#x27;-c:a&#x27;, &#x27;aac&#x27;, // aac || copy
            &#x27;-strict&#x27;, &#x27;-2&#x27;,
            &#x27;-vbsf&#x27;, &#x27;h264_mp4toannexb&#x27;
        ]);
    }
    else {
        opt = opt.concat([
            &#x27;-c:v&#x27;, &#x27;linx264&#x27;,
            &#x27;-c:a&#x27;, &#x27;aac&#x27;,
            // &#x27;-g&#x27;, 100,
            // &#x27;-vcodec&#x27;, &#x27;copy&#x27;,
            // &#x27;-acodec&#x27;, &#x27;copy&#x27;,
            &#x27;-b&#x27;, &#x27;500k&#x27;,
            &#x27;-ac&#x27;, &#x27;2&#x27;,
            &#x27;-ar&#x27;, &#x27;44100&#x27;,
            &#x27;-ab&#x27;, &#x27;32k&#x27;
        ]);
    }

    // TODO: HLS by ffmpeg
    // opt = opt.concat([
    //     &#x27;-f&#x27;, &#x27;hls&#x27;,
    //     &#x27;-hls_time&#x27;, &#x27;10&#x27;,
    //     &#x27;-hls_list_size&#x27;, &#x27;999&#x27;,
    //     &#x27;out/0.m3u8&#x27;
    // ]);

    opt.push( tsOutput );

    return opt;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if ( fs.existsSync( outfile ) &#x26;&#x26; false) {
    fs.createReadStream( outfile ).pipe( res );
    return;
}

var f = spawn(
    this.options.lib + &#x27;ffmpeg&#x27;,
    this.<span class="apidocCodeKeywordSpan">command4FFMpeg</span>( index, outfile )
);

var output = &#x27;&#x27;;
f.stdout.on( &#x27;data&#x27;, function ( chunk ) {
    output += chunk;
    self.emit( &#x27;process&#x27;, { index: index, file: outfile, out: chunk } );
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.HLS.prototype.command4FFProbe" id="apidoc.element.airplay-js.HLS.prototype.command4FFProbe">
        function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>command4FFProbe
        <span class="apidocSignatureSpan">( filePath )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">command4FFProbe = function ( filePath ) {
    var opt = [
        &#x27;-v&#x27;,
        &#x27;quiet&#x27;,
        &#x27;-print_format&#x27;, &#x27;json&#x27;,
        &#x27;-show_format&#x27;,
        &#x27;-show_streams&#x27;,
        filePath
    ];

    return opt;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    return; // We assume that which will return != 0 so on(&#x27;close&#x27;) will handle the NoFFMPEG case.
}
// # -------------------------------------------------- # //

if(data.length &#x3e;0){
    self.openThread = spawn(
        self.options.lib + &#x27;ffprobe&#x27;,
        self.<span class="apidocCodeKeywordSpan">command4FFProbe</span>( self.file ));
    var output = &#x27;&#x27;;
    self.openThread.stdout.on( &#x27;data&#x27;, function ( chunk ) {
        output += chunk;
    });
    self.openThread.stderr.on( &#x27;data&#x27;, function ( err ) {
        self.emit(
            &#x27;error&#x27;,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.HLS.prototype.getURI" id="apidoc.element.airplay-js.HLS.prototype.getURI">
        function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>getURI
        <span class="apidocSignatureSpan">( type, index )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getURI = function ( type, index ) {
    if ( type === &#x27;video&#x27; ) {
        return &#x27;/stream/0.m3u8&#x27;;
    }
    else if ( type === &#x27;audio&#x27; ) {
        return &#x27;/stream/1.m3u8&#x27;;
    }
    else if ( type === &#x27;iframes&#x27; ) {
        return &#x27;/iframes.m3u8&#x27;;
    }
    else if ( type === &#x27;segment&#x27; ) {
        return &#x27;/stream/0/&#x27; + index + &#x27;.ts&#x27;;
    }
    else {
        return this.baseURI;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        });
    }
);
this.client.on( &#x27;ping&#x27;, function () { self.emit( &#x27;ping&#x27; ); });

self.hls = require( &#x27;../airplay&#x27; ).createHLS();
self.hls.on( &#x27;start&#x27;, function () {
    console.info( &#x27;[HLS] start: %s&#x27;, self.hls.<span class="apidocCodeKeywordSpan">getURI</span>() );
});
self.hls.on( &#x27;stop&#x27;, function () {
    console.info( &#x27;[HLS] stop: %s&#x27;, self.hls.getURI() );
});
self.hls.on( &#x27;request&#x27;, function ( req ) {
    // var uri = url.parse( req.url, true );
    console.info( &#x27;[HLS] request: %s&#x27;, req.url );
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.HLS.prototype.httpHandler" id="apidoc.element.airplay-js.HLS.prototype.httpHandler">
        function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>httpHandler
        <span class="apidocSignatureSpan">( request, response )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">httpHandler = function ( request, response ) {
    var ops = this.options;
    var header = {};
    var body = [];
    var uri = url.parse( request.url, true );
    var self = this

    this.emit( &#x27;request&#x27;, request );

    if ( uri.pathname === &#x27;/&#x27; ) {
        console.log(&#x22;attending /&#x22;)
        body.push( &#x27;#EXTM3U&#x27; );
        body.push( &#x27;#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID=&#x22;audio&#x22;,LANGUAGE=&#x22;und&#x22;,NAME=&#x22;Original Audio&#x22;,DEFAULT=YES,AUTOSELECT=YES&#x27; );
        console.log(this.subtitles)
        if(this.subtitles){
            this.subtitles.forEach(function(each){
                body.push( &#x27;#EXT-X-MEDIA:TYPE=SUBTITLES,GROUP-ID=&#x22;subs&#x22;,NAME=&#x22;English&#x22;,DEFAULT=YES,AUTOSELECT=YES,FORCED=NO,LANGUAGE
=&#x22;en&#x22;,URI=&#x22;http://&#x27;+self.address+&#x27;:&#x27;+self.port+&#x27;/subtitles/&#x27;+each.language+&#x27;.m3u8&#x22;&#x27; )
            })
        }
        //body.push( &#x27;#EXT-X-MEDIA:TYPE=SUBTITLES,GROUP-ID=&#x22;subs&#x22;,NAME=&#x22;Spanish&#x22;,DEFAULT=NO,AUTOSELECT=NO,FORCED=YES,LANGUAGE=&#x22;en
&#x22;,URI=&#x22;http://carlosguerrero.com/b.m3u8&#x22;&#x27; )

        // stream#0
        if(this.subtitles){
            body.push( &#x27;#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=20000000,CODECS=&#x22;mp4a.40.2,avc1.640028&#x22;,AUDIO=&#x22;audio&#x22;,SUBTITLES
=&#x22;subs&#x22;&#x27; );
        }else{
            body.push( &#x27;#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=20000000,CODECS=&#x22;mp4a.40.2,avc1.640028&#x22;,AUDIO=&#x22;audio&#x22;&#x27; );
        }
        body.push( this.getURI( &#x27;video&#x27; ) );

        // // stream#1
        // body.push( &#x27;#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=20000000,CODECS=&#x22;ac-3,avc1.640028&#x22;,AUDIO=&#x22;audio&#x22;&#x27; );
        // body.push( &#x27;/stream/1.m3u8&#x27; );

        // // frames
        // body.push( &#x27;#EXT-X-I-FRAME-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=20000000,CODECS=&#x22;avc1.640028&#x22;,URI=&#x22;/iframes.m3u8&#x22;&#x27; );

        body.push( &#x27;#EXT-X-ENDLIST&#x27; );
        body = body.join( &#x27;\n&#x27; );

        // header[&#x27;Content-Type&#x27;] = &#x27;application/vnd.apple.mpegurl&#x27;;
        header[ &#x27;Content-Length&#x27; ] = body.length;

        response.writeHead( 200, header );
        response.write( body );

        response.end();
    }
    else if ( uri.pathname === this.getURI( &#x27;video&#x27; ) ) {
        var tsDuration = ops.duration;
        var videoDuration = parseFloat( this.videoInfo.format.duration, 10 );

        body.push( &#x27;#EXTM3U&#x27; );
        body.push( &#x27;#EXT-X-VERSION:3&#x27; );
        // body.push( &#x27;#EXT-X-PLAYLIST-TYPE:EVENT&#x27; );
        body.push( &#x27;#EXT-X-MEDIA-SEQUENCE:0&#x27; );
        body.push( &#x27;#EXT-X-TARGETDURATION:&#x27; + tsDuration );
        body.push( &#x27;#EXT-X-PLAYLIST-TYPE:VOD&#x27; );
        body.push( &#x27;#EXT-X-ALLOW-CACHE:&#x27; + ( ops.cache ? &#x27;YES&#x27; : &#x27;NO&#x27;) );

        for ( var i = 1, n = this.segmentSize; i &#x3c; n; i++ ) {
            body.push(
                &#x27;#EXTINF:&#x27;
                // 最后一个分段一般会少一点，需要精确计算下
                + ( i &#x3e;= n ? ( videoDuration % tsDuration || tsDuration ) : tsDuration )
                + &#x27;,&#x27;
            );
            body.push( this.getURI( &#x27;segment&#x27;, i ) );
        }

        body.push( &#x27;#EXT-X-ENDLIST&#x27; );
        body = body.join( &#x27;\n&#x27; );

        // header[&#x27;Connection&#x27;] = &#x27;Keep-Alive&#x27;;
        // header[&#x27;Content-Type&#x27;] = &#x27;application/vnd.apple.mpegurl&#x27;;
        header[&#x27;Content-Length&#x27;] = body.length;

        response.writeHead( 200, header );
        response.write( body );
        response.end();
    }
    // else if ( uri.pathname === this.getURI( &#x27;audio&#x27; ) ) {
    // }
    // else if ( uri.pathname === this.getURI( &#x27;iframes&#x27; ) ) {
    //     body.push( &#x27;#EXTM3U&#x27; );
    //     body.push( &#x27;#EXT-X-VERSION:4&#x27; );
    //     body.push( &#x27;#EXT-X-TARGETDURATION:3&#x27; );
    //     body.push( &#x27;#EXT-X-I-FRAMES-ONLY&#x27; );
    //     body.push( &#x27;#EXT-X-PLAYLIST-TYPE:VOD&#x27; );
    //     body.push( &#x27;#EXT-X-ALLOW-CACHE:YES&#x27; );
    //     body.push( &#x27;#EXT-X-MEDIA-SEQUENCE:0&#x27; );

    //     body.push( &#x27;#EXTINF:3.000000000000000,&#x27; );
    //     body.push( &#x27;#EXT-X-BYTERANGE:2097152@564&#x27; );

    //     body.push( &#x27;/iframes/0.ts&#x27; );
    //     body.push( &#x27;#EXTINF:3.000000000000000,&#x27; );
    //     body.push( &#x27;#EXT-X-BYTERANGE:2097152@564&#x27; );
    //     body.push( &#x27;/iframes/1.ts&#x27; );
    //     ...

    //     body.push( &#x27;#EXT-X-ENDLIST&#x27; );
    // }
    else if ( /^\/stream\/0\//.test( uri.pathname ) ) ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.HLS.prototype.open" id="apidoc.element.airplay-js.HLS.prototype.open">
        function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>open
        <span class="apidocSignatureSpan">( fileFullPath, callback )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">open = function ( fileFullPath, callback ) {
    var self = this;
    var media = fileFullPath

    console.log(&#x22;fileFullPath:&#x22;)
    console.log(fileFullPath)
    console.log(typeof(fileFullPath))
    if (typeof(fileFullPath) != &#x27;string&#x27;){
        self.subtitles = media.subtitles
        fileFullPath = media.file
    }

    if ( this.openThread ) {
        this.openThread.kill();
    }

    this.file = fileFullPath;

    var whichCommand = /^win/.test(process.platform) ? &#x27;where&#x27; : &#x27;which&#x27;

    self.checkFirst = spawn(whichCommand,[&#x27;ffprobe&#x27;])
    self.checkFirst.on(&#x27;close&#x27;, function(data){
        console.log(&#x22;x:&#x22;+data)
        if(data!=0){
            console.log(&#x22;No FFMPEG FOUND :(&#x22;)
            self.emit(&#x22;NoFFMPEG&#x22;)
            return 0;
        }
    })
    self.checkFirst.stdout.on(&#x27;data&#x27;, function(data){
        console.log(&#x22;d:&#x22;+data)

        // # -------------------------------------------------- # //
        // TODO: find the ffmpeg path when the object is constructed instead of resolving it now.
        // PATCH to actually find the ffmpeg executable
        var ffmpegPath = data.toString(&#x22;utf8&#x22;).trim()
        if(data.length &#x3e; 0 &#x26;&#x26; fs.existsSync(ffmpegPath)) {
            var ffmpegPath = path.dirname(ffmpegPath) + path.sep
            if(self.options.lib != ffmpegPath) {
                self.options.lib = ffmpegPath
                console.log(&#x22;FFMPEG path set to &#x22; + ffmpegPath)
            }
        } else {
            self.emit(&#x22;NoFFMPEG&#x22;)
            return; // We assume that which will return != 0 so on(&#x27;close&#x27;) will handle the NoFFMPEG case.
        }
        // # -------------------------------------------------- # //

        if(data.length &#x3e;0){
            self.openThread = spawn(
                self.options.lib + &#x27;ffprobe&#x27;,
                self.command4FFProbe( self.file ));
            var output = &#x27;&#x27;;
            self.openThread.stdout.on( &#x27;data&#x27;, function ( chunk ) {
                output += chunk;
            });
            self.openThread.stderr.on( &#x27;data&#x27;, function ( err ) {
                self.emit(
                    &#x27;error&#x27;,
                    { type: &#x27;open&#x27;, err: err, file: fileFullPath }
                );
            });
            self.openThread.stdout.on( &#x27;end&#x27;, function () {
                var json;
                try {
                    json = JSON.parse( output );
                } catch (e) {
                    self.emit(
                        &#x27;error&#x27;,
                        { type: &#x27;open&#x27;, err: e.message, file: fileFullPath }
                    );
                }
                if ( json ) {
                    self.videoInfo = json;
                    // update store
                    self.segmentSize = Math.ceil( parseFloat( json.format.duration, 10 ) / self.options.duration );
                    self.emit( &#x27;open&#x27;, { file: fileFullPath, info: json } );
                }
                if ( callback ) {
                    callback( json );
                }
                self.openThread = null;
            });
            return self;
        }
    })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

//#TODO: Check if has ffmpeg and if not, go directly to simpleplay
//
console.log(typeof(media))
self.hls.start( 7001 + this.id );

console.log(&#x22;going to play: &#x22;+media)
self.hls.<span class="apidocCodeKeywordSpan">open</span>( media , function ( info ) {
    device.simpleplay( self.hls.getURI(), &#x27;0.000000&#x27;, function ( res ) {
        console.info( &#x27;-&#x3e;&#x3e; &#x27;, res );
        setTimeout(function(){
            device.status( function ( info ) {
                console.info( &#x27;-&#x3e;&#x3e; &#x27;, info ? info : &#x27;no info &#x3e;(&#x27; );
                if ( info ) {
                    console.log(info)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.HLS.prototype.segment" id="apidoc.element.airplay-js.HLS.prototype.segment">
        function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>segment
        <span class="apidocSignatureSpan">( index, req, res )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">segment = function ( index, req, res ) {
    var self = this;
    var outfile = this.options.out + index + &#x27;.ts&#x27;;

    // skip if exists
    if ( fs.existsSync( outfile ) &#x26;&#x26; false) {
        fs.createReadStream( outfile ).pipe( res );
        return;
    }

    var f = spawn(
        this.options.lib + &#x27;ffmpeg&#x27;,
        this.command4FFMpeg( index, outfile )
    );

    var output = &#x27;&#x27;;
    f.stdout.on( &#x27;data&#x27;, function ( chunk ) {
        output += chunk;
        self.emit( &#x27;process&#x27;, { index: index, file: outfile, out: chunk } );
    });
    f.stdout.on( &#x27;error&#x27;, function ( err ) {
        self.emit(
            &#x27;error&#x27;,
            { type: &#x27;segment&#x27;, err: err, index: index, file: outfile }
        );
    });

    f.stdout.on( &#x27;end&#x27;, function () {
        self.emit( &#x27;segment&#x27;, { index: index, file: outfile, out: output } );
        fs.createReadStream( outfile ).pipe( res );
    });

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    //     body.push( &#x27;#EXT-X-ENDLIST&#x27; );
    // }
    else if ( /^\/stream\/0\//.test( uri.pathname ) ) {
header[&#x27;Content-Type&#x27;] = &#x27;video/MP2T&#x27;;
response.writeHead( 200, header );

var tsIndex = parseInt( path.basename( uri.pathname, &#x27;.ts&#x27; ), 10 );
this.<span class="apidocCodeKeywordSpan">segment</span>( tsIndex, request, response );
this.emit( &#x27;stream&#x27;, tsIndex, this.segmentSize );
// fs.createReadStream( filePath ).pipe( response );
// response.write( fs.readFileSync( filePath ) );
// response.end();
    } else if ( /^\/subtitles/.test(uri.pathname) ){

var selected = uri.pathname.substring(11,uri.pathname.length)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.HLS.prototype.setSubtitles" id="apidoc.element.airplay-js.HLS.prototype.setSubtitles">
        function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>setSubtitles
        <span class="apidocSignatureSpan">( subtitles )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setSubtitles = function ( subtitles ){
    console.log(&#x22;Setting subtitles to: &#x22;+subtitles)
    var self = this
    self.subtitles = subtitles
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.HLS.prototype.start" id="apidoc.element.airplay-js.HLS.prototype.start">
        function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>start
        <span class="apidocSignatureSpan">( port )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function ( port ) {
    if ( !this.started ) {
        this.started = !0;

        this.baseURI = &#x27;http://&#x27; + IP_LOCAL + ( port === 80 ? &#x27;&#x27; : &#x27;:&#x27; + port );

        this.server = http.createServer( this.httpHandler.bind( this ) );
        this.server.listen( port, IP_LOCAL );

        this.emit( &#x27;start&#x27;, { host: IP_LOCAL, port: port } );
    }

    this.port = port
    this.address = IP_LOCAL

    return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// remote video
var browser = require( &#x27;airplay-js&#x27; ).createBrowser();
browser.on( &#x27;deviceOn&#x27;, function( device ) {
    device.play( &#x27;http://remotehost/video.mp4&#x27;, 0, function() {
        console.info( &#x27;video playing...&#x27; );
    });
});
browser.<span class="apidocCodeKeywordSpan">start</span>();
```

## Testing

```
npm install
npm test
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.airplay-js.HLS.prototype.stop" id="apidoc.element.airplay-js.HLS.prototype.stop">
        function <span class="apidocSignatureSpan">airplay-js.HLS.prototype.</span>stop
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stop = function () {
    if ( this.started &#x26;&#x26; this.server ) {
        this.server.close();
        this.emit( &#x27;stop&#x27; );
    }

    this.started = !1;

    return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.airplay-js.browser" id="apidoc.module.airplay-js.browser">module airplay-js.browser</a></h1>


    <h2>
        <a href="#apidoc.element.airplay-js.browser.Browser" id="apidoc.element.airplay-js.browser.Browser">
        function <span class="apidocSignatureSpan">airplay-js.browser.</span>Browser
        <span class="apidocSignatureSpan">( options )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Browser = function ( options ) {
    events.EventEmitter.call( this );
    this.init( options );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
/**
* create a Browser
*
* @param {Object=} options
* @return {Browser} instance of Browser
*/
exports.createBrowser = function ( options ) {
   return new exports.<span class="apidocCodeKeywordSpan">Browser</span>( options );
};

/**
* connect a airplay device
*
* @param {string} host airplay host
* @param {number} port airplay port
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.airplay-js.client" id="apidoc.module.airplay-js.client">module airplay-js.client</a></h1>


    <h2>
        <a href="#apidoc.element.airplay-js.client.Client" id="apidoc.element.airplay-js.client.Client">
        function <span class="apidocSignatureSpan">airplay-js.client.</span>Client
        <span class="apidocSignatureSpan">( options, callback )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Client = function ( options, callback ) {
    events.EventEmitter.call( this );

    var self = this;

    // { port, host, localAddress, path, allowHalfOpen }
    this.options = options;
    this.responseQueue = [];

    this.socket = net.createConnection( options, function() {
        self.responseQueue.push( callback );
        self.ping();
    });

    this.socket.on( &#x27;data&#x27;, function( data ) {
        var res = self.parseResponse( data.toString() );
        // util.puts( util.inspect( res ) );

        var fn = self.responseQueue.shift();
        if ( fn ) {
            fn( res );
        }
    });

    // TODO
    this.socket.on( &#x27;error&#x27;, function ( err ) {
        // FIXME: 这里会时不时的抛出异常: &#x27;Uncaught, unspecified &#x22;error&#x22; event.&#x27;
        try {
            self.emit( &#x27;error&#x27;, { type: &#x27;socket&#x27;, res: err } );
        } catch( e ) {
            console.info( e.message );
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.airplay-js.device" id="apidoc.module.airplay-js.device">module airplay-js.device</a></h1>


    <h2>
        <a href="#apidoc.element.airplay-js.device.Device" id="apidoc.element.airplay-js.device.Device">
        function <span class="apidocSignatureSpan">airplay-js.device.</span>Device
        <span class="apidocSignatureSpan">( id, info, name, callback )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Device( id, info, name, callback ) {
    var self = this;

    events.EventEmitter.call( this );

    this.id = id;
    this.info = info;
    this.name = name;
    // this.serverInfo = null;
    this.pingDelay = 5 * 1000; // 心跳间隔

    this.client = new Client(
        {
            host: info[0], port: 7000
            // ,user: &#x27;zfkun&#x27;, pass: &#x27;&#x27;
        },
        function () {
            self.client.serverInfo(function( info ) {
                self.serverInfo = info;
                self.onReady( callback );
            });
        }
    );
    this.client.on( &#x27;ping&#x27;, function () { self.emit( &#x27;ping&#x27; ); });

    self.hls = require( &#x27;../airplay&#x27; ).createHLS();
    self.hls.on( &#x27;start&#x27;, function () {
        console.info( &#x27;[HLS] start: %s&#x27;, self.hls.getURI() );
    });
    self.hls.on( &#x27;stop&#x27;, function () {
        console.info( &#x27;[HLS] stop: %s&#x27;, self.hls.getURI() );
    });
    self.hls.on( &#x27;request&#x27;, function ( req ) {
        // var uri = url.parse( req.url, true );
        console.info( &#x27;[HLS] request: %s&#x27;, req.url );
    });
    self.hls.on( &#x27;process&#x27;, function ( d ) {
        console.info( &#x27;[HLS] segment process: %s, %s, %s&#x27;, d.index, d.file, d.out.toString() );
    });
    self.hls.on( &#x27;segment&#x27;, function ( d ) {
        console.info( &#x27;[HLS] segment created: %s, %s, %s&#x27;, d.index, d.file, d.out );
    });
    self.hls.on( &#x27;open&#x27;, function ( d ) {
        console.info( &#x27;[HLS] opend: %s, %s&#x27;, d.file, util.inspect( d.info ) );
    });
    self.hls.on( &#x27;error&#x27;, function ( err ) {
        console.info( &#x27;[HLS] segment error: &#x27;, util.inspect( err ) );
    });


}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.airplay-js.hls" id="apidoc.module.airplay-js.hls">module airplay-js.hls</a></h1>


    <h2>
        <a href="#apidoc.element.airplay-js.hls.HLS" id="apidoc.element.airplay-js.hls.HLS">
        function <span class="apidocSignatureSpan">airplay-js.hls.</span>HLS
        <span class="apidocSignatureSpan">( options )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function HLSServer( options ) {
    events.EventEmitter.call( this );
    var ops = this.options = options || {};

    // 是否启用流模式(影响m3u8生成机制)
    // ops.streaming = !!ops.streaming;
    // TS文件缓存
    ops.cache = !!ops.cache;
    // TS分片时长(s)
    ops.duration = ops.duration || 20;
    // 编解码库目录
    ops.lib = path.normalize( ops.lib || ( __dirname + &#x27;/../dep&#x27; ) ) + &#x27;/&#x27;;
    if ( !fs.existsSync( ops.lib ) ) {
        ops.lib = &#x27;&#x27;;
    }
    // TS分片输出目录
    ops.out = path.normalize( ops.out || ( &#x27;/tmp&#x27; ) ) + &#x27;/&#x27;;
    if ( !fs.existsSync( ops.out ) ) {
        fs.mkdirSync( ops.out );
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
/**
* create a HLS Server
*
* @param {Object=} options
* @return {HLS} instance of HLS
*/
exports.createHLS = function ( options ) {
   return new exports.<span class="apidocCodeKeywordSpan">HLS</span>( options );
};

/**
* create a Browser
*
* @param {Object=} options
* @return {Browser} instance of Browser
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
